"use strict";var express=require("express"),router=express.Router(),Employee=require("../models/employee"),Skill=require("../models/skill"),EmpSkill=require("../models/emp_skill"),Project=require("../models/project"),catchErrors=require("../lib/async-error"),bcrypt=require("bcrypt");function generateHash(e){return bcrypt.hash(e,10)}function comparePassword(e,t){return bcrypt.compare(e,t)}function validateForm(e){var t=e.name||"",r=e.id||"",n=e.password||"";return t?t.length<2?"이름은 두 글자 이상 입력해주세요.":r?n?n.length<7?"비밀번호가 너무 짧습니다. (8자 이상)":null:"비밀번호를 입력해주세요.":"ID를 입력해주세요.":"이름을 입력해주세요."}function getDday(e){var t=new Date,r=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),o=e.split(" ")[0].split("-");return r==o[0]&&n==o[1]&&o[2]-a<=7?o[2]-a:null}router.get("/",function(e,t,r){t.render("index",{title:"Index"})}),router.get("/signup",catchErrors(function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Skill.findAll());case 2:r=e.sent,t.render("signup",{skills:r});case 4:case"end":return e.stop()}})})),router.get("/mypage",function(t,r){var n,a,o,i,u,s,l,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t.session.authorization||r.json({message:"you should login"}),e.next=3,regeneratorRuntime.awrap(Employee.findOne({where:{authorization_no:t.session.authorization}}));case 3:return n=e.sent,a=n.id,o=n.pwd,i=n.education,u=n.name,s=n.work_experience,l=n.emp_no,e.next=7,regeneratorRuntime.awrap(Skill.findAll({include:[{model:EmpSkill,where:["emp_no = ".concat(l)]}],attributes:["skill_name"]}));case 7:c=e.sent,r.json({id:a,pwd:o,education:i,skill:c,name:u,work_experience:s});case 9:case"end":return e.stop()}})}),router.route("/signin").get(function(e,t){t.render("signin",{})}).post(catchErrors(function(t,r){var n,a,o,i,u,s,l,c,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.body),e.next=3,regeneratorRuntime.awrap(Employee.findOne({where:{ID:t.body.id}}));case 3:if(n=e.sent){e.next=7;break}return t.flash("danger","존재하지 않는 ID 입니다."),e.abrupt("return",r.redirect("back"));case 7:return e.next=9,regeneratorRuntime.awrap(Project.findAll({where:{state:"진행중"},include:[{model:Employee,as:"project_emp",through:{where:{emp_no:n.emp_no}}}]}));case 9:for(a=e.sent,i=!(o=!0),u=void 0,e.prev=13,s=a[Symbol.iterator]();!(o=(l=s.next()).done);o=!0)c=l.value,(p=getDday(c.dataValues.end_date))&&t.flash("warning","".concat(c.project_name," 프로젝트의 마감일자까지 ").concat(p,"일 남았습니다."));e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),i=!0,u=e.t0;case 21:e.prev=21,e.prev=22,o||null==s.return||s.return();case 24:if(e.prev=24,i)throw u;e.next=27;break;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return t.session.user=n,t.session.authorization=n.authorization_no,t.flash("success","".concat(n.name,"님 환영합니다!")),e.abrupt("return",r.redirect("/"));case 33:case"end":return e.stop()}},null,null,[[13,17,21,29],[22,,24,28]])})),router.post("/signup",catchErrors(function(t,r){var n,a,o,i,u,s,l,c,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.body),n=validateForm(t.body))return t.flash("danger",n),e.abrupt("return",r.redirect("back"));e.next=5;break;case 5:return e.next=7,regeneratorRuntime.awrap(Employee.findOne({where:{ID:t.body.id}}));case 7:if(a=e.sent)return t.flash("danger","이미 존재하는 ID 입니다."),e.abrupt("return",r.redirect("back"));e.next=11;break;case 11:return e.next=13,regeneratorRuntime.awrap(generateHash(t.body.password));case 13:return o=e.sent,e.next=16,regeneratorRuntime.awrap(Employee.create({name:t.body.name,ID:t.body.id,PWD:o,dept_no:t.body.department,authorization_no:null,education:t.body.education,work_experience:null}));case 16:a=e.sent,u=!(i=!0),s=void 0,e.prev=20,l=t.body.skills[Symbol.iterator]();case 22:if(i=(c=l.next()).done){e.next=29;break}return p=c.value,e.next=26,regeneratorRuntime.awrap(EmpSkill.create({emp_no:a.emp_no,skill_no:p}));case 26:i=!0,e.next=22;break;case 29:e.next=35;break;case 31:e.prev=31,e.t0=e.catch(20),u=!0,s=e.t0;case 35:e.prev=35,e.prev=36,i||null==l.return||l.return();case 38:if(e.prev=38,u)throw s;e.next=41;break;case 41:return e.finish(38);case 42:return e.finish(35);case 43:t.flash("success","정상적으로 회원가입되었습니다."),r.redirect("/");case 45:case"end":return e.stop()}},null,null,[[20,31,35,43],[36,,38,42]])})),router.get("/signout",function(e,t,r){delete e.session.user,e.flash("success","정상적으로 로그아웃 되었습니다."),t.redirect("/")}),router.get("/test",function(e,t,r){t.render("index2",{title:"Express",name:"han sh"})}),router.get("/test3",function(e,t,r){t.render("signup",{title:"Express"})}),router.get("/nav_developer",function(e,t,r){t.render("nav_develop",{title:"Express"})}),router.get("/nav_management",function(e,t,r){t.render("nav_management",{title:"Express"})}),router.get("/addproject",function(e,t,r){t.render("addProject",{title:"Express"})}),router.get("/mypage",function(e,t,r){t.render("mypage/mypageview",{title:"Express"})}),router.get("/myprofileedit",function(e,t,r){t.render("mypage/myProfileEdit",{title:"Express"})}),router.get("/evaluation/customer_evaluation",function(e,t,r){t.render("evaluation/customer_evaluation",{title:"Express"})}),router.get("/evaluation/inputCustomer_evaluation",function(e,t,r){t.render("evaluation/inputCustomer_evaluation",{title:"Express"})}),router.get("/evaluation/peer_evaluation",function(e,t,r){t.render("evaluation/peer_evaluation",{title:"Express"})}),router.get("/evaluation/inputPeer_evaluation",function(e,t,r){t.render("evaluation/inputPeer_evaluation",{title:"Express"})}),router.get("/evaluation/pm_evaluation",function(e,t,r){t.render("evaluation/pm_evaluation",{title:"Express"})}),router.get("/evaluation/inputPm_evaluation",function(e,t,r){t.render("evaluation/inputPm_evaluation",{title:"Express"})}),router.get("/evaluation/customer_evaluation",function(e,t,r){t.render("evaluation/customer_evaluation",{title:"Express"})}),router.get("/evaluation/inputCustomer_evaluation",function(e,t,r){t.render("evaluation/inputCustomer_evaluation",{title:"Express"})}),router.get("/evaluation/modification_customerEval",function(e,t,r){t.render("evaluation/modification_customerEval",{title:"Express"})}),router.get("/evaluation/modification_peerEval",function(e,t,r){t.render("evaluation/modification_peerEval",{title:"Express"})}),router.get("/management/evaluationResult_inquiry",function(e,t,r){t.render("management/evaluationResult_inquiry",{title:"Express"})}),router.get("/evaluation/resultCustomer_eval",function(e,t,r){t.render("evaluation/resultCustomer_eval",{title:"Express"})}),router.get("/evaluation/resultPm_eval",function(e,t,r){t.render("evaluation/resultPm_eval",{title:"Express"})}),router.get("/evaluation/resultPeer_eval",function(e,t,r){t.render("evaluation/resultPeer_eval",{title:"Express"})}),router.get("/project/list",function(e,t,r){t.render("project/list",{title:"Express"})}),router.get("/project/new",function(e,t,r){t.render("project/new",{title:"Express"})}),router.get("/project/details",function(e,t,r){t.render("project/details",{title:"Express"})}),router.get("/project/modify",function(e,t,r){t.render("project/modify",{title:"Express"})}),router.get("/project/checkTask",function(e,t,r){t.render("project/checkTask",{title:"Express"})}),router.get("/addclient",function(e,t,r){t.render("addclient",{title:"Express"})}),module.exports=router;
//# sourceMappingURL=index.min.js.map
