"use strict";var express=require("express"),router=express.Router(),Employee=require("../models/emp"),catchErrors=require("../lib/async-error"),bcrypt=require("bcrypt");function generateHash(e){return bcrypt.hash(e,10)}function comparePassword(e,r){return bcrypt.compare(e,r)}function validateForm(e){var r=e.name||"",t=e.id||"",n=e.password||"";return r?r.length<2?"이름은 두 글자 이상 입력해주세요.":t?n?n.length<7?"비밀번호가 너무 짧습니다. (8자 이상)":null:"비밀번호를 입력해주세요.":"ID를 입력해주세요.":"이름을 입력해주세요."}router.get("/",function(e,r,t){r.render("index",{title:"Index"})}),router.get("/signup",function(e,r){r.render("signup",{})}),router.route("/signin").get(function(e,r){r.render("signin",{})}).post(catchErrors(function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r.body),e.next=3,regeneratorRuntime.awrap(Employee.findOne({where:{ID:r.body.id}}));case 3:if(n=e.sent){e.next=7;break}return r.flash("danger","Not exist user."),e.abrupt("return",t.redirect("back"));case 7:return e.next=9,regeneratorRuntime.awrap(comparePassword(r.body.password,n.PWD));case 9:if(e.sent){e.next=13;break}return r.flash("danger","Passsword do not match."),e.abrupt("return",t.redirect("back"));case 13:return r.session.user=n,r.session.authorization=n.authorization_no,r.flash("success","Welcome!"),e.abrupt("return",t.redirect("/"));case 17:case"end":return e.stop()}})})),router.post("/signup",catchErrors(function(r,t){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(r.body),n=validateForm(r.body))return r.flash("danger",n),e.abrupt("return",t.redirect("back"));e.next=5;break;case 5:return e.next=7,regeneratorRuntime.awrap(Employee.findOne({id:r.body.id}));case 7:if(e.sent)return r.flash("danger","이미 존재하는 ID 입니다."),e.abrupt("return",t.redirect("back"));e.next=11;break;case 11:return e.next=13,regeneratorRuntime.awrap(generateHash(r.body.password));case 13:return s=e.sent,e.next=16,regeneratorRuntime.awrap(Employee.create({name:r.body.name,ID:r.body.id,PWD:s,dept_no:null,authorization_no:null,education:null,work_experience:null}));case 16:e.sent,r.flash("success","Registered successfully. Please sign in."),t.redirect("/");case 19:case"end":return e.stop()}})})),router.get("/signout",function(e,r,t){delete e.session.user,e.flash("success","Successfully signed out."),r.redirect("/")}),router.get("/test",function(e,r,t){r.render("index2",{title:"Express",name:"han sh"})}),router.get("/test3",function(e,r,t){r.render("signup",{title:"Express"})}),router.get("/nav_developer",function(e,r,t){r.render("nav_develop",{title:"Express"})}),router.get("/nav_management",function(e,r,t){r.render("nav_management",{title:"Express"})}),router.get("/addproject",function(e,r,t){r.render("addProject",{title:"Express"})}),router.get("/myprofileedit",function(e,r,t){r.render("myProfileEdit",{title:"Express"})}),router.get("/project/list",function(e,r,t){r.render("project/list",{title:"Express"})}),router.get("/project/new",function(e,r,t){r.render("project/new",{title:"Express"})}),router.get("/project/details",function(e,r,t){r.render("project/details",{title:"Express"})}),router.get("/project/modify",function(e,r,t){r.render("project/modify",{title:"Express"})}),module.exports=router;
//# sourceMappingURL=index.min.js.map
